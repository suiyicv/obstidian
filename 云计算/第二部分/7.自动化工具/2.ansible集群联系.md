![[Pasted image 20240611111429.png|500]]
规划
两个调度器
192.168.140.41
192.168.140.42
两个web
192.168.140.50
192.168.140.51
两个mysql
192.168.140.46
192.168.140.47
nfs
192.168.140.40
ansible
192.168.140.45

ansible:
```bash
wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repoyum -yum -y install ansible
vim /etc/ansible/hosts
	[keepalived]
	192.168.140.41
	192.168.140.42
	[web]
	192.168.140.43
	192.168.140.44
	[nfs]
	192.168.140.40
ansible all -m ping 
```
首先编写nfs服务器安装配置启动的剧本
```bash title:nfs服务器安装配置启动的剧本
- hosts: nfs
  tasks:
       - name: install nfs
         yum:
             name: nfs-utils
             state: present

       - name: shezhi public mulu
         shell:
             mkdir -p  /public/blog

       - name: bianxie peizhi wenjian
         lineinfile:
             path: /etc/exports
             line: "/public/blog 192.168.140.0/24(rw)"

       - name: qidong fuwu
         service:
             name: nfs-server
             state: started
             enabled: yes
```
ansible web -m shell -a "showmount -e 192.168.140.40"
![[Pasted image 20240625215707.png]]
编写web安装nfs的剧本
```bash title:安装nfs客户端
- hosts: web
  tasks:
       - name: wei webfuwuqi install nfs-utils
         yum:
             name: nfs-utils
             state: present
```
编写web安装nginx的剧本
```bash title:安装nginx
      get_url:
        url: https://nginx.org/download/nginx-1.20.2.tar.gz
        dest: /root/nginx-1.20.2.tar.gz

    - name: install nginx dependencies
      yum:
        name:
          - gcc
          - openssl-devel
          - pcre-devel
          - zlib-devel
        state: present

    - name: 解压nginx软件包
      unarchive:
        src: /root/nginx-1.20.2.tar.gz
        dest: /root/
        remote_src: yes

    - name: configure nginx
      shell: ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
      args:
        chdir: /root/nginx-1.20.2

    - name:  compile  nginx
      shell: make
      args:
        chdir: /root/nginx-1.20.2
    - name: install nginx
      shell: make install
      args:
        chdir: /root/nginx-1.20.2
    
	- name: 启动nginx
      shell: /usr/local/nginx/sbin/nginx
    - name: 检查端口是否启动
      shell: netstat -tunlp | grep nginx
```
编写安装php的剧本
yum install epel-release
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
网络问题安装不上
rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
yum --enablerepo=remi install php72-php
应为 网络问题还是不行
223.5.5.5
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm


使用remi源安装
yum install -y epel-release
yum install https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm
yum install yum-utils
yum-config-manager --disable 'remi-php*'
yum-config-manager --enable   remi-php72
yum clean all
yum install -y  mariadb-server
yum -y install php php-cli php-fpm php-common php-devel php-embedded php-gd php-mbstring php-mysqlnd php-opcache php-pdo php-xml 

systemctl enable --now mariadb
systemctl enable --now php-fpm
netstat -tunlp | grep php


编写安装php的剧本
```bash title:编写安装php的剧本

- hosts: web
  tasks:
    - name: Install epel-release
      yum:
        name: epel-release
        state: present

    - name: Install remi-release
      yum:
        name: https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm
        state: present

    - name: Install yum-utils
      yum:
        name: yum-utils
        state: present

    - name: Disable remi-php*
      command: yum-config-manager --disable 'remi-php*'

    - name: Enable remi-php72
      command: yum-config-manager --enable remi-php72

    - name: Clean yum cache
      command: yum clean all

    - name: Install required packages
      yum:
        name:
          - mariadb-server
          - php
          - php-cli
          - php-fpm
          - php-common
          - php-devel
- php-devel
          - php-embedded
          - php-gd
          - php-mbstring
          - php-mysqlnd
          - php-opcache
          - php-pdo
          - php-xml
        state: present

    - name: Enable and start MariaDB service
      service:
        name: mariadb
        enabled: yes
        state: started

    - name: Enable and start PHP-FPM service
      service:
        name: php-fpm
        enabled: yes
        state: started


```


将nginx和php融合
mkdir -p  /usr/local/nginx/conf.d/
vim /usr/local/nginx/conf.d/blog.




