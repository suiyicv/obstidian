![[Pasted image 20240611111429.png|500]]
规划
两个调度器
192.168.140.41
192.168.140.42
两个web
192.168.140.43
192.168.140.44
两个mysql
192.168.140.46
192.168.140.47
nfs
192.168.140.40
ansible
192.168.140.45

ansible:
```bash
wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repoyum -yum -y install ansible
vim /etc/ansible/hosts
	[keepalived]
	192.168.140.41
	192.168.140.42
	[web]
	192.168.140.43
	192.168.140.44
	[nfs]
	192.168.140.40
ansible all -m ping 
```
首先编写nfs服务器安装配置启动的剧本
```bash title:nfs服务器安装配置启动的剧本
- hosts: nfs
  tasks:
       - name: install nfs
         yum:
             name: nfs-utils
             state: present

       - name: shezhi public mulu
         shell:
             mkdir -p  /public/blog

       - name: bianxie peizhi wenjian
         lineinfile:
             path: /etc/exports
             line: "/public/blog 192.168.140.0/24(rw)"

       - name: qidong fuwu
         service:
             name: nfs-server
             state: started
             enabled: yes
```
ansible web -m shell -a "showmount -e 192.168.140.40"
![[Pasted image 20240625215707.png]]
编写web安装nfs的剧本
```bash title:安装nfs客户端
- hosts: web
  tasks:
       - name: wei webfuwuqi install nfs-utils
         yum:
             name: nfs-utils
             state: present
```
编写web安装nginx的剧本
```bash title:安装nginx
      get_url:
        url: https://nginx.org/download/nginx-1.20.2.tar.gz
        dest: /root/nginx-1.20.2.tar.gz

    - name: install nginx dependencies
      yum:
        name:
          - gcc
          - openssl-devel
          - pcre-devel
          - zlib-devel
        state: present

    - name: 解压nginx软件包
      unarchive:
        src: /root/nginx-1.20.2.tar.gz
        dest: /root/
        remote_src: yes

    - name: configure nginx
      shell: ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
      args:
        chdir: /root/nginx-1.20.2

    - name:  compile  nginx
      shell: make
      args:
        chdir: /root/nginx-1.20.2
    - name: install nginx
      shell: make install
      args:
        chdir: /root/nginx-1.20.2
    
	- name: 启动nginx
      shell: /usr/local/nginx/sbin/nginx
    - name: 检查端口是否启动
      shell: netstat -tunlp | grep nginx


```