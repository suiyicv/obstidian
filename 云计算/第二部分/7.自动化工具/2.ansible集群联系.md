![[Pasted image 20240611111429.png|500]]
规划
两个调度器
192.168.140.41
192.168.140.42
两个web
192.168.140.43
192.168.140.44
两个mysql
192.168.140.46
192.168.140.47
nfs
192.168.140.40
ansible
192.168.140.45

ansible:
```bash
wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repoyum -yum -y install ansible
vim /etc/ansible/hosts
	[keepalived]
	192.168.140.41
	192.168.140.42
	[web]
	192.168.140.43
	192.168.140.44
	[nfs]
	192.168.140.40
ansible all -m ping 
```
首先编写nfs服务器安装配置启动的剧本
```bash title:nfs服务器安装配置启动的剧本
- hosts: nfs
  tasks:
       - name: install nfs
         yum:
             name: nfs-utils
             state: present

       - name: shezhi public mulu
         shell:
             mkdir -p  /public/blog

       - name: bianxie peizhi wenjian
         lineinfile:
             path: /etc/exports
             line: "/public/blog 192.168.140.0/24(rw)"

       - name: qidong fuwu
         service:
             name: nfs-server
             state: started
             enabled: yes
```
ansible web -m shell -a "showmount -e 192.168.140.40"
![[Pasted image 20240625215707.png]]
编写web安装nfs的剧本
```bash title:安装nfs客户端
- hosts: web
  tasks:
       - name: wei webfuwuqi install nfs-utils
         yum:
             name: nfs-utils
             state: present
```
编写web安装nginx的剧本
```bash title:安装nginx
      get_url:
        url: https://nginx.org/download/nginx-1.20.2.tar.gz
        dest: /root/nginx-1.20.2.tar.gz

    - name: install nginx dependencies
      yum:
        name:
          - gcc
          - openssl-devel
          - pcre-devel
          - zlib-devel
        state: present

    - name: 解压nginx软件包
      unarchive:
        src: /root/nginx-1.20.2.tar.gz
        dest: /root/
        remote_src: yes

    - name: configure nginx
      shell: ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module
      args:
        chdir: /root/nginx-1.20.2

    - name:  compile  nginx
      shell: make
      args:
        chdir: /root/nginx-1.20.2
    - name: install nginx
      shell: make install
      args:
        chdir: /root/nginx-1.20.2
    
	- name: 启动nginx
      shell: /usr/local/nginx/sbin/nginx
    - name: 检查端口是否启动
      shell: netstat -tunlp | grep nginx
```
编写安装php的剧本
yum install epel-release
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
网络问题安装不上
rpm -ivh http://rpms.famillecollet.com/enterprise/remi-release-7.rpm
yum --enablerepo=remi install php72-php
应为 网络问题还是不行
223.5.5.5
rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm

**通过源码包编译的方式安装**
yum -y install gcc automake autoconf libtool make
yum -y install gcc gcc-c++ glibc
yum -y install libmcrypt-devel mhash-devel libxslt-devel libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel bzip2 bzip2-devel ncurses ncurses-devel curl curl-devel e2fsprogs e2fsprogs-devel krb5 krb5-devel libidn libidn-devel openssl openssl-devel openldap-devel
wget http://am1.php.net/distributions/php-7.2.2.tar.gz
tar -zxvf php-7.2.2.tar.gz

./configure --prefix=/app/php --with-config-file-path=/app/php/etc --with-curl --with-freetype-dir --with-gd \
--with-gettext --with-iconv-dir --with-kerberos --with-libdir=lib64 --with-libxml-dir --with-mysqli --with-openssl --with-pcre-regex \
--with-pdo-mysql --with-pdo-sqlite --with-pear --with-png-dir --with-jpeg-dir --with-xmlrpc --with-xsl --with-zlib --with-bz2 \
--with-mhash --enable-fpm --enable-bcmath --enable-libxml --enable-inline-optimization --enable-mbregex \
--enable-mbstring --enable-opcache --enable-pcntl --enable-shmop --enable-soap --enable-sockets --enable-sysvsem --enable-sysvshm \
--enable-xml --enable-zip --with-ldap

make -j 4
make install