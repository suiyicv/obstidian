
常见部署架构

多实例部署  
主从复制  
分片集群  
哨兵集群

1.多实例部署
安装目录: /opt/6380 端口: 6380  
安装目录: /opt/6381 端口: 6381

规划安装目录、配置文件
mkdir -p /opt/638{0,1}/{conf,data}
cp /usr/local/redis50/conf/redis.conf /opt/6380/conf/

编辑实例配置文件
vim /opt/6380/conf/redis.conf 

```bash
bind 192.168.140.10
port 6380
daemonize yes
appendonly yes
pidfile /var/run/redis_6380.pid
loglevel warning
logfile "/var/log/redis_6380.log"
dbfilename dump_6380.rdb
dir /opt/6380/data
appendfilename "appendonly_6380.aof"
```

redis-server /opt/6380/conf/redis.conf 
netstat -tunlp | grep redis
![[Pasted image 20240607173942.png]]
redis-server /usr/local/redis50/conf/redis.conf
netstat -tunlp | grep redis
![[Pasted image 20240607174122.png]]

cp /opt/6380/conf/redis.conf   /opt/6381/conf/redis.conf
sed -ri 's|6380|6381|g' /opt/6381/conf/redis.conf
redis-server /opt/6381/conf/redis.conf 
netstat -tunlp | grep redis
![[Pasted image 20240607174511.png]]
多实例

测试数据读写
redis-cli -h 192.168.1.100 -p 6380
```bash
192.168.1.100:6380> set name martin 
OK 
192.168.1.100:6380> get name 
"martin"
```



2.redis主从复制

在主从复制基础上，整合读写分离提升性能  
从服务器默认为只读  
基于异步的方式进行数据同步  
支持一主多从

规划
192.168.1.100（主）
192.168.1.110（从）

从服务器配置
vim /opt/6381/conf/redis.conf
replicaof 192.168.1.100 6380
如果你的主redis有密码的话
masterauth XXXXXXXXX

redis-server /opt/6381/conf/redis.conf

验证主从状态
netstat -antp | grep redis
![[Pasted image 20240607183011.png]]

```bash
redis-cli -h 192.168.1.100 -p 6380
set a 100

redic-cli -h 192.168.1.100 -p 6381
get a
"100"
set b 20  #只读模式不能写入
(error) READONLY You can't write against a read only replica.
```

主服务器状态：
redis-cli -h 192.168.1.100 -p 6380
info replication
![[Pasted image 20240607183643.png]]

从服务器状态:
redis-cli -h 192.168.1.100 -p 6381 
info replication
![[Pasted image 20240607183849.png]]



主从角色切换
将从服务器提升为主
redis-cli -h 192.168.1.100 -p 6380 shutdown
主redis down了，从redis只能读操作，不能写，此时需要把从redis提升为主redis
redis-cli -h 192.168.1.100 -p 6381
把链接的主服务器的信息全部清掉
SLAVEOF no one
info replication
![[Pasted image 20240607184328.png]]
此时已经变成主redis了
```bash 
192.168.1.100:6381> set b 20  #已经可以写数据了
OK
```

把之前配置的从服务配置注释掉
vim /opt/6381/conf/redis.conf
~~replicaof 192.168.1.100 6380~~  
重启启动
redis-cli -h 192.168.1.100 -p 6381 shutdown
redis-server /opt/6381/conf/redis.conf
此时将6380 设置为从
vim /opt/6380/conf/redis.conf
replicaof 192.168.1.100 6381



3.redis分片集群
redis 3.x版本开始支持的  
作用：所有缓存数据分散存储到不同的redis上，提升读写性能， 提升数据可靠性

6.4-7-04:25



