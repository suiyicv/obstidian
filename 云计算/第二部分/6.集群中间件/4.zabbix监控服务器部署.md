基本上要监控一些设备cpu的使用情况，内存，磁盘，网卡的流量，上面的用户，进程等等
监控的目的，就是为了让运维人员能够及时的知道那个机器出现什么异常了，然后能够及时的响应这个问题，解决这个问题。

# 一.监控的方式
## 1.人工巡检
巡检脚本
机房规模越大，这种常规的手段出现的频率就越高，巡检还包括查看一些物理设备的运行状态
## 2.监控软件
zabbix 
IT基础设备（网络设备，服务器，存储）
promethues
适用于容器化应用的监控

## 3.zabbix监控获取数据的方式
我们的监控服务器，想利用它去搜集一些服务器的cpu，内存啥的，我们想要的这些数据怎么搜集？
通过一下四种方式
2.1 <font color="#d99694">zabbix-agent</font>， 适用于服务器、主机监控
2.2 <font color="#d99694">SNMP协议</font>，适用于网络设备(交换机、路由器、防火墙、IDS/IPS)
2.2  <font color="#d99694">udp/161</font>， v2版本稳定版，只要是能联网的设备都支持这个协议
2.3 <font color="#d99694">IPMI协议</font>，适用于监控硬件设备信息(温度、序列号)
2.4 <font color="#d99694">JMX协议</font>，适用于java应用的监控
![[Pasted image 20240623183119.png]]


# 二.zabbix server部署

## 1.确保时间同步
## 2.添加epel源
wget -O /etc/yum.repos.d/epel.repo https://mirrors.aliyun.com/repo/epel-7.repo
![[Pasted image 20240623184138.png]]
## 3.添加zabbix仓库
vim /etc/yum.repos.d/zabbix.repo
[zabbix]
name=zabbix
baseurl=https://mirrors.aliyun.com/zabbix/zabbix/4.4/rhel/7/x86_64/
enabled=1
gpgcheck=0

zabbix4.5以后要求是centos8
## 4.安装zabbix服务端软件
zabbix支持两种数据库 mysql postgreSQL
yum install -y mariadb-server zabbix-server-mysql zabbix-web-mysql 
安装软件的时候会把apache和php都当成依赖，为了那个web界面能够正常展示
## 5.在数据库创建zabbix需要的表、授权用户
systemctl enable --now mariadb
mysql -uroot
create database zabbix charset utf8 collate utf8_bin;
create user 'zbuser'@'localhost' identified by 'redhat';
grant all on zabbix.* to 'zbuser'@'localhost';
flush privileges;
cd /usr/share/doc/zabbix-server-mysql-4.4.10/
![[Pasted image 20240623185828.png]]
zcat create.sql.gz | mysql -uroot zabbix
检查一下导入成功没
mysql -uroot
use  zabbix;
show tables;
![[Pasted image 20240623191015.png]]

## 6.编辑zabbix server配置文件
指定数据库连接
ls /etc/zabbix/
![[Pasted image 20240623191125.png]]
cd /etc/zabbix
vim zabbix_server.conf
	DBHost=localhost 
	DBName=zabbix 
	DBUser=zbuser 
	DBPassword=redhat 
	DBSocket=/var/lib/mysql/mysql.sock

## 7.启动zabbix server
systemctl enable --now zabbix-server
netstat -tunlp | grep zabbix
![[Pasted image 20240623192042.png]]
## 8.初始化zabbix webUI
vim /etc/httpd/conf.d/zabbix.conf 
php_value date.timezone Asia/Shanghai
![[Pasted image 20240623192233.png]]
systemctl enable --now httpd
## 9.访问zabbix webUI
http://192.168.140.10/zabbix/
![[Pasted image 20240623192512.png|400]]
![[Pasted image 20240623192609.png|400]]
![[Pasted image 20240623192704.png|400]]
![[Pasted image 20240623192716.png|400]]


![[Pasted image 20240623193055.png]]

![[Pasted image 20240623193125.png]]

# 三.本机监控配置
![[Pasted image 20240623193610.png]]
在这里显示监控了那些机器，刚配置好zabbix server 后，会默认监控本机，但是故障状态。
## 1.安装配置zabbix-agent
yum install -y zabbix-agent 
vim /etc/zabbix/zabbix_agentd.conf 
	Server= 192.168.140.14              # 监控服务器地址
	ServerActive=192.168.140.14    # 监控服务器地址
	Hostname=Zabbix server           # 被监控机名称，惟一
server 跟 serveractive 都是写监控服务器ip，但是为什么要写两边呢？
与zabbix-agent的工作模式有关，zabbix-agent两种工作模式： 主动；被动（默认为被动 ）
<font color="#d99694">主动模式</font>：是指这个agent会主动向server汇报，就是agent搜集完数据之后会主动把数据发送给server这叫主动模式
<font color="#d99694">被动模式</font>：是指agent搜集完数据之后，它等着server来找，他才会把搜集到的新数据给server
systemctl enable --now zabbix-agent
netstat -tunlp | grep zabbix
![[Pasted image 20240623195311.png]]
## 2.在web界面修改agent监听地址
![[Pasted image 20240623195447.png]]
需要一分钟左右才能联系到agent，慢慢的就能开始搜集数据
![[Pasted image 20240623195618.png]]

## 3.查看监控图形
![[Pasted image 20240623195839.png]]
![[Pasted image 20240623195907.png]]

## 4.解决图形乱码问题
mv simkai.ttf /usr/share/zabbix/assets/fonts/
ls /usr/share/zabbix/assets/fonts/
![[Pasted image 20240623200546.png]]
vim /usr/share/zabbix/include/defines.inc.php 
define('ZBX_GRAPH_FONT_NAME',           'msyh'); # font file name

define('ZBX_FONT_NAME', 'msyh');
![[Pasted image 20240623201047.png]]
![[Pasted image 20240623200946.png]]



# 四.监控其他主机
## 1.在被监控机安装部署zabbix-agent
scp root@192.168.140.14:/etc/yum.repos.d/zabbix.repo /etc/yum.repos.d/
yum install -y zabbix-agent 
vim /etc/zabbix/zabbix_agentd.conf 
	Server=监控服务器地址
	ServerActive=监控服务器地址
	Hostname=agent1.linux.com
systemctl enable --now zabbix-agent
netstat -tunlp | grep zabbix
![[Pasted image 20240623202431.png]]
## 2.在web界面添加监控主机
![[Pasted image 20240623203029.png]]
现在添加成功主机了，但是可用性不会发生变化
![[Pasted image 20240623203430.png]]
这个可用性这，什么时候才会有状态变化？
只有这个监控服务器能正常搜集到数据之后，这个可用性才会有变化
## 3.给监控机连接模板
![[Pasted image 20240623203934.png|500]]
![[Pasted image 20240623204902.png]]
![[Pasted image 20240623204958.png]]
可用性显示

## 4.系统级别的监控数据参考
从第八个视频开始看






# 主机自动监控
## 1.自动监控
## 2.web检测
针对网站服务器，检测网站的访问质量
监控两个指标：
网站的响应时间
客户端在访问我们网站的时候的su'd













