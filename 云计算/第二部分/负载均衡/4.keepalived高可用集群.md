# 一.keepalived高可用介绍

解决单点故障，提升服务高可用

基于VRRP协议设计
原理：
将多个物理设备放入到一个VRRP组中，通过VRRP组形成浮动IP，通过优先级进行主备选举，优先级高为主，浮动IP会配置到主设备上，同时主设备会发送心跳以通知自己的状态，备设备连续一段时间接收不到心跳，则认为主宕机，会自动接替主的工作

心跳：
默认以组播的方式发送心跳，地址224.0.0.18
影响心跳的因素：
1、防火墙
2、时间不同步
3、网络堵塞，多块网卡分担流量

# 二.keepalived高可用设计

![[Pasted image 20240612143718.png]]
## 1.两台haproxy负载均衡器配置一致

客户端通过DNS解析两台haproxy都可正常访问业务
有相同的服务配置
scp /etc/haproxy/haproxy.cfg
root@192.168.137.131:/etc/haproxy/haproxy.cfg
systemctl restart haproxy

虽然现在设置好了两个haproxy，但是他们现在是独立的，没有任何关系。

## 2.在haproxy上分别安装keepalived

```bash
yum install -y keepalived
```

## 3.配置keepalived实现高可用

规划浮动IP：192.168.137.100
192.168.137.130 当主
192.168.137.131 当备

192.168.137.130
vim  /etc/keepalived/keepalived.conf
![[Pasted image 20240613013319.png]]

192.168.137.131
vim  /etc/keepalived/keepalived.conf
![[Pasted image 20240613013557.png]]

## 4.两边都启动一下keepalived
systemctl enable --now keepalived


## 5.分别在两个调度器上查看浮动IP

192.168.137.130 有

192.168.137.131 无