
# 一.集群技术概述
## 1.集群技术类型

负载均衡集群， Load Balance LB  
[高可用集群](https://so.csdn.net/so/search?q=%E9%AB%98%E5%8F%AF%E7%94%A8%E9%9B%86%E7%BE%A4&spm=1001.2101.3001.7020)， High Avalibility HA
## 2.负载均衡技术

服务器单台机器的性能毕竟是有限的
假设单台机器所能承载的客户端连接最多只有一万
当单个客户端的访问量超过一万的时候，超过了这个单机的处理瓶颈
就会造成客户端访问越来越慢

如何解决这个问题
两方面
1.scale in  向内扩展，去升级这个机器的配置，缺点：成本太高。适用于个人pc的扩展
2.scale out 向外扩展 ，负载均衡集群的思想，通过增加机器的数量
涉及到一个话题，摆了三个一莫一样的机器，这三个机器，肯定是三个不同的ip地址
后端找多个服务器，来跑一摸一样的业务
第一：为了方便客户端的访问
第二：让着三个服务器能够共同承担所有的流量

后端前面会放一个负载均衡器，由负载均衡器来接受客户端的请求，然后这个负载均衡器，通过一定的策略或者说算法，再有这个负载均衡器把客户端的请求分别转发到相应的业务服务器，由业务服务器来处理真正的请求

一个负载均衡集群
![[Pasted image 20240610224539.png]]

负载均衡器
负载均衡器，要是真正实现负载均衡的功能，流量分发的功能，这个东西他带具备什么样子的能力
1.接受请求的能力，创建虚拟服务
2.添加后端的服务器

实现方式
1.软件 nginx(upstream),lvs,haproxy
2.硬件 F5

最终目的：提升业务的并发




## 3.高可用技术

避免关键业务的单点故障  
通过优先级选择主备角色，主负责转发[客户端](https://so.csdn.net/so/search?q=%E5%AE%A2%E6%88%B7%E7%AB%AF&spm=1001.2101.3001.7020)流量 ，同时会向备发送心跳信息，备一段时间内接收不到心跳，会认为主宕机故障，自动会接替主的工作继续转发流量

![[Pasted image 20240610234149.png]]
如果这个负载均衡器故障了，那整个业务就坏了
为了避免负载均衡器成为单点故障，我们可以再额外加一个
负载均衡器
主要目的就是为了让他们形成一个高可用，或者说，是让这俩负载均衡器形成一个备份

同一时间只有一个负载均衡器在工作
假设客户端正常访问我们的业务的时候，所有的流量都走上面的负载均衡器
一旦检测到上面的负载均衡器故障了以后，会自动 切换到下面的负载均衡器
，这样子客户端就可以继续访问我们的业务。

两个负载均衡器，肯定有所谓的主备。
假设上面的是主，那下面的自然是备

两个问题：
1.两负载均衡器摆在这里，靠什么决定谁当主，谁当备的呢？
靠我们人为的给这两个负载均衡器，配置一个优先级
优先级：1-255之间的数字
谁的数字越大，谁的优先级就越高

高可用一旦主备角色确认好之后
上面的主调度，除了会转发正常的客户端流量之外
这个主调度还会负责另一件事情，就是周期性的向这个备调度，发从<span style="background:#affad1">心跳</span>信息
默认一秒发一次
只要备调度，能够正常接收到这个心跳，那他就知道这个主调度是正常运行的

连续一段时间（三秒）接受不到主调度发送的心跳信息，则认为主调度故障
，然后备调度就会接替主调度的工作，继续向机器内部转发流量




# 二.负载均衡 LVS

1.LVS


