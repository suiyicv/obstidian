图形化的方式添加磁盘
## 1.命令行的方式添加磁盘
### 1.1  查看虚拟磁盘
virsh domblklist centos7.0
![[Pasted image 20240709091740.png]]
添加磁盘
### 1.2 添加磁盘文件
qemu-img create -f qcow2 /var/lib/libvirt/images/vm01.img 5G
![[Pasted image 20240709091949.png]]
virsh attach-disk centos7.0  --source /var/lib/libvirt/images/vm01.img --target vdb --cache writeback --subdriver qcow2 --persistent
--cache 指定磁盘的缓存工作模式
(1)writeback      <span style="background:#affad1"> 回写</span>
当磁盘缓存空间不足时，才会将所有数据写入硬盘
(2)writethrough <span style="background:#affad1">通写</span>
磁盘缓存接收数据，立刻会写入磁盘
![[Pasted image 20240709092135.png]]
virsh domblklist centos7.0
![[Pasted image 20240709092154.png]]
virsh detach-disk centos7.0 vdb --persistent
![[Pasted image 20240709093309.png]]
相当于现实中把硬盘从机器上面拔下来，硬盘中的数据还存在

## 2.磁盘镜像文件
## 2.1 磁盘镜像文件的格式
raw： 一次性分配所有空间
<span style="background:#affad1">qcow2 </span>
	稀疏格式
	快照、压缩、加密
	<span style="background:#affad1">后端镜像</span>/差量镜像
		快速创建虚拟机
## 2.2 创建磁盘文件
qemu-img create -f qcow2 /opt/disk01.qcow2 8G
## 2.3查看磁盘文件的信息
qemu-img info /opt/disk01.qcow2
![[Pasted image 20240709094436.png]]
## 4.创建差量镜像
### 4.1快速创建虚拟机
qemu-img create -f qcow2 -b /opt/disk01.img /data/disk01_new.img

virsh list --all
![[Pasted image 20240709095434.png]]
ls /var/lib/libvirt/images/
![[Pasted image 20240709095520.png]]
qemu-img create -f qcow2 -b /var/lib/libvirt/images/ centos7.0.qcow2   /var/lib/libvirt/images/centos7.0_new.qcow2
### 4.2准备配置文件
cd /var/lib/libvirt/qemu/
cp centos7.0.xml  test1_centos.xml
vim test1_centos.xml
修改虚拟名称、UUID(uuidgen)、磁盘文件位置、MAC地址、VNC(vnc -1)
配置文件设置完毕

### 4.3创建虚拟机
virsh define /etc/libvirt/qemu/test1_centos79.xml
![[Pasted image 20240709105254.png]]
virsh list --all
![[Pasted image 20240709105358.png]]
virsh start test1_centos
 

# 三.批量部署虚拟机

通过脚本的方式批量部署
# 四.存储池 storage pool
## 1.定义
作用：用于存储磁盘镜像文件的位置
virsh pool-list --all
![[Pasted image 20240709141916.png]]
virsh pool-dumpxml default

## 2.类型 
本地存储池
网络存储池
在公司里面大多用的都是网络存储池
## 3.虚拟机迁移
 
离线迁移：稳定可靠，但是影响业务的连续性
	虚拟机关机
	拷贝配置文件、磁盘镜像文件
	virsh define <配置文件名称>
	virsh start
在线迁移：存储池必须网络存储

3.1 配置NFS服务器
3.2 创建存储
