# Openstack(<font color="#ff0000">no</font>)
云操作系统
提供了一个构建云服务的框架
## 1.云的简介(<font color="#ff0000">no</font>)
大量的虚拟化的资源池
云的核心底层技术：虚拟化
### 1.1 优势
按需自助的服务
广泛的网络接入
弹性伸缩
资源池化
### 1.2 根据云平台提供的服务不同
Iaas
	基础设施(服务器、存储、网络设备)即服务
	Infrastracture As a Service
Paas
	平台即服务
	Platform As A service
Saas
	软件即服务
	Software As A Service
![[Pasted image 20240711220044.png]]
### 1.3 根据提供服务范围不同
- 公有云
- 私有云
- 混合云
## 2.openstack核心组件(<font color="#00b050">ok</font>)
云操作系统，构建云平台提供了一个框架
现在外面一些做云的厂商，他们自己的私有云产品都是在openstack的基础上做了大量的二次开发，然后形成了自己的产品
<span style="background:#affad1">要对openstack里面的一些核心组件要有一个整体的认知</span>
openstack是一堆软件的组合，统称为openstack
<font color="#d99694">openstack在云平台中起什么作用？</font>

openstack版本 
命名是按字母命名的，ceph这个软件的命名就是随openstack来的，也是按英文字母命名

核心组件
nova glance neutron cinder switft keystone heat lronic dashboard
![[Excalidraw/Drawing 2024-07-10 19.49.48.excalidraw.md#^group=FRBwRiMKyPVnAMyw6VAB5|700]]
云上这些所有的组件都是给<span style="background:#affad1">云服务器(VM)</span>服务的
### 2.1 Nova组件
<span style="background:#affad1">提供计算compute服务</span>
负责云服务器(计算资源)的<span style="background:#affad1">整个生命周期管理</span>(创建，查看，更新，删除)
我们在任何一个云平台上面，之所以能购买云服务器，配置好参数以后这个云服务器就能够被真正的创建出来，然后这个云服务器创建相关的所有操作都是由Nova这个组件负责完成的

**Nova的核心组件**
组件内部有设计了很多的子部件
![[Pasted image 20240711204737.png|525]]

| 名称               | 作用                             |
| ---------------- | ------------------------------ |
| nova-api         | 接收关于云服务器的操作请求                  |
| nova-scheduler   | 调度操作请求                         |
| nova-compute     | 调用计算节点的Hypervisor真正实现云服务器创建、删除 |
| nova-conductor   | 与数据库交互，处理云服务器的元数据信息            |
| nova-consoleauth | 提供认证，认证登录云服务器时，用户名、密码、密钥       |
| nova-novncproxy  | 提供VNC的方式登录服务器                  |

nova-api 
主要负责接收有关于云服务器的操作请求，将来你要拿openstack搭建云平台，无论是通过UI还是通过命令行，你要搭建云服务器或者删除云服务，总要有人来接受你的请求，这个就是nova-api做的事情
nova-scheduler是用来做调度的
按照官方给我们的建议自己要去搭建openstack的话，至少要两个机器
![[Pasted image 20240711205452.png|450]]
一个控制节点，一个计算节点
控制节点需要装一些openstack运行必备的一些基础组件（时间同步，mysql，消息队列，memory catch等）nova在设计的时候内部会涉及很多个子进程，当创建云服务器的时候，要传递很多数据，为了实现同一个组件内部多个不同的子进程之间的高效通信，需要消息队列的支持，memory catch跟redis类似，是用来做缓存的，存一些用户的令牌，用户的一些认证信息
计算节点，云上边所创建出来的那个云服务器，本质上就是一个kvm虚机，计算节点就是将来跑虚机的结点。所谓的云服务器，就是跑在计算节点上的一个虚拟机，要是做一个稍微有点规模的云平台，计算节点不可能只是一个（成百上千）
我们就拿创建来说，第一个进程叫做nova-api，他收到一个请求，这个api肯定能从这个请求里面看到我要建一个云服务器的名字，我要什么样子的规格，我的镜像是什么样的，这些请求里面应该包含这些数据，这些数据叫做云服务器的元数据，接收到这些请求之后，再通过keystone验证这个请求是合法的后，这个api会联系DB，把云服务器的元数据存储在这个数据库里面
nova-scheduler这个调度，是调度什么的呢？创建云服务器的时候，这个机器应该建在那个计算节点上？假设我们这个规模里面有几十甚至几百个计算几点，这么多计算节点存在，是不是应该有一个所谓的调度，帮我们选择一个合适的节点，来真正创建这个云服务器，这就是调度。
调度就是负责选择一个合适的计算节点，再去真正的去创建这个云服务器

nova-compute是跑在计算节点上的一个进程，我们之前说，nova节点是负责创建删除云服务器的，但是这个创建删除的操作，并不是nova做的，而是hypervisor
nova这个组件他本身并没有创建删除虚拟机的功能，其实是这么一回事
api接受到一个请求，然后这个请求通过scheduler调度帮我们去选择一个合适的计算节点创建虚拟机，那这个云服务器是怎么建出来的？我们假设在第一个节点上面创建虚拟机。这个调度，把这个请求调度到第一个节点，这个请求是由一个叫做nova computer的节点接收的
他接收到有人给我发了一个请求，让我去建一个虚拟机，但是nova本身并没有真正创建删除的功能，真正的创建删除是靠我们装在这计算机点上的hypervisor实现的（默认使用的是kvm）

nova-api接收到一个创建请求，然后又这个调度帮他选着一个合适的计算节点，然后这个计算节点选择了之后，再把这个请求转交到这个计算节点身上的compute，nova-computer,真正拿到这个要创建或者删除的请求之后，他会去调用我们在计算节点上真正装的这个hypervisor来真正的实现创建，真正的实现删除
现在所有的hypervisor都是硬件复制的虚拟化，将来做基础环境准备的时候，所有的计算节点必须开启虚拟化功能

nova-compute接收到要创建这个服务器的请求，他确实要调用hypervisor真正的把这个虚机建出来，但他在见这个虚拟机的时候，他是不是应该需要知道这个虚拟机的名字叫什么？应该分配多大的硬盘，应该介入到那个网络当中去，他是不是应该知道这些信息呀，但是他是怎么 知道这些信息的呢？这就涉及到另一个组件叫做nova-conductor

nova-conductor,真正调用hypervisor之前nova-compute 是不是要去数据库里面拿到这个要被创建的服务器的元数据信息，拿到之后，再去按照这个元数据，再去调用hypervisor把服务器按需创建出来，谁来帮nova-compute 去数据库里面那这个信息呢？就是中间的nova-conductor
这就是核心的四个进程，这四个进程一个不成功，虚拟机就创建不出来



Nova只是单纯的提供建服务器的功能，但是这个服务器真正能创建成功，还需要其他组件的配合，比如说创建虚拟机的时候需要选择镜像，这个镜像谁提供的？就是下面的glance组件

### 2.2 Glance组件
提供镜像image服务
负责镜像的上传，查看，删除
结合虚拟化来说，这里所说的镜像，其实就是一个.qcow2格式的磁盘文件，或者是.iso格式的系统镜像文件
两个子进程
glance-api
接收关于镜像的api请求的调用，包括镜像的查看更新存储
![[Pasted image 20240712183404.png]]
glance在存储镜像的时候支持多种存储方式，S3亚马逊对外提供的一个对象存储服务
glance-registry 就是用来和后台的数据库交互，来存储一些和镜像相关的数据(镜像的元数据信息)。open stack里面的每个组件运行的时候都会产生数据，所以都需要关联后端数据库存储


### 2.3  Cinder组件
提供卷volume服务
负责为云服务器提供卷服务(云硬盘/虚拟磁盘)/虚拟磁盘的整个生命周期的管理

如果你要子啊你的云平台里面构建这个卷服务的话，建议在增加一个节点block storage 块存储节点
![[Pasted image 20240712200416.png]]
无论是你服务器本地插了很多硬盘也好，还是说你的存储节点后面关联了很多存储设备，你既然作为整个云平台对外提供块存储服务，那其实，将来就是你得把你提供的这个零散个磁盘空间给集中到一起，然后在往外边分，也就说先虚拟出一个大的存储池，然后在根据用户的需求把磁盘空间划分出去。
这些零散的空间通过什么技术能够集中到一起去？
通过lvm集中到一起去，云磁盘底层里面涉及到的一个核心技术就是当初学的逻辑卷，把所有的磁盘形成一个卷组，通过这个卷组就想到于把所有的空间集中到了一起，云平台搭好以后，我们的这个终端用户购买硬盘，无非就是在这个卷组里面给我划分一个一个的卷

按照我们的open stack网络拓扑来说，其中有一类是计算节点，计算节点就是用来跑虚拟机的，现在有一类存储节点，他底层可以通过lvm这样的底层技术，把所有的空间集中起来，然后再往外分配，假设云平台搭设完成以后，有人购买一个5GB的硬盘，其实就是底层的lvm检出了一个5G的卷，那着里面有什么问题呢？这个卷肯定是建立在存储节点上的，而你买的云服务器是跑在计算节点上的，那从最终使用的角度来讲，我肯定是要把这个硬盘，加到某一个云服务上面去，这里面涉及到的问题就是，你的云服务器在计算节点上，你的5G的硬盘在存储节点上，怎么通过什么东西把这个5G的磁盘关联到计算节点上？
能往外直接共享块设备的，按照我们之前说的存储就是san存储，按照协议来说就是iscsi协议，将来用户在我这购买了虚拟磁盘之后，为了这个磁盘能够关联到某一个云服务器上面去用，采用的就是共享的方式，走的就是iscsi协议和scsi协议
什么时候走iscsi呢？就看你中间所有设备的网络连接，如果走的是IP网络走的就是iscsi，如果走的是光纤网络走的就是scsi了。

涉及的技术：LVM、iSCSI/SCSI共享块设备
cinder组件的核心进程
![[Pasted image 20240712202744.png|450]]

cinder-api，负责接收请求、路由请求到cinder-volume上
cinder-scheduler，负责选择合适的存储节点
cinder-volume，负责调用底层的存储接口/驱动真正创建、销毁虚拟磁盘
cinder-backup，负责提供磁盘备份服务，配合swift对象存储使用






### 2.4 neutron组件
提供网络network服务
负责为云服务器提供网络连接
比如：vpc;sg安全组;nat;vpn;负载均衡器
早年的iaas主要是提供基础设施服务的，基础设置就三样，计算；网络；存储
单纯是iaas平台的话 nova glance cinder neutron 是最核心的组件
整个所有的openstack里面所有的组件设计最复杂的就是neutron
核心进程就一个
neutron-server
接收用于关于到我们这个云平台上面网络创建呀，查看完了网络接入这些请求，接收到请求之后，neutron-server还会把这些请求转发到合适的网络插件上面
单说neutron，是提供网络连接的，但是从整个open stack的设计的角度来讲，这个云平台上面所有的网络功能都是通过各个插件来的
![[Pasted image 20240712190011.png]]
网络的元数据信息也是要存到后边的数据库的
每个插件和neutron-server高校交互的时候都通过消息队列

所有的云平台后端核心的技术就是虚拟化技术

网络虚拟化技术
vpc怎么实现的？
最基本的网络功能是靠Open vSwitch 实现的，这就是网络上的一个虚拟化技术，对于虚拟话网络里面所说的那个虚拟网络就相当于模拟生活中的交换机的功能，它主要用到的技术就是open vswitch 
Linux bridging 桥接技术

vxlan 
在云平台上面，你创建一个vpc你就要指定一个网段，这个网段我可以指192；你也可以指定为192，对于华为云的后端而言，他怎么支持这么多人在他身上建出来这么多的虚拟网络呢？单纯从数量和网络隔离上面来说，他用的是什么技术呢？用的技术就是vxlan
vlan是用在交换机上的技术，vlan能够实现网络隔离的功能(划分广播域)要给，一个交换机上可以创建4096个，交换机在碰到广播类型的数据的时候他默认会泛洪
单纯的虚拟化环境里面那一个虚拟网络就相当于一个vlan，从云的角度来说，我们也可以理解为一个vpc就是一个vlan。
就刚才我们说，我们建了多个vpc他是怎么帮我们实现网络隔离？思想是vlan的这个思想，但是用技术不是vlan这个技术，应为你在建vlan的时候一个交换机上面最多只能建立4096个vlan，如果放在现实中的环境肯定是够的，但是放在云上肯定是不够的，所以自动虚拟化技术出现之后vlan技术也发生了一个改革，产生了vxlan，vxlan相当于vlan核心有两个好处，第一个很大程度上扩展了这个数量（不受数量的限制）
第二个好处就是，在云上或者从物理环境上来说，给我们做设备迁移带来了很大的便利，
平常的迁移IP地址会变，IP地址变了会影响业务的，牵一发而动全身，而vxlan呢，在原始的数据包上的最外层又增加了一个二层封装，然后就可以实现，将来主机也好，服务器也好，他在跨网段迁移的时候可以保存IP不变。
数据封装要封装个样东西，源端口目的端口，源IP目的IP，端mac目的mac，这是传统的数据封装，如果这个数据是跨网段传输的，它必然需要经过路由，传统的路由是根据目的ip来转发数据的，所以vxlan改变了传统的根据IP的方式转发数据的方式，他子啊传统的数据包上又多加了一层新的mac地址的封装，有了这个新的mac地址的封装，哪怕你这个地址和以前是不同网段的，我不按照IP的方式走，我按照mac地址的方式，这样按网络上来说，我就可以实现一个2层的跨传，哪怕这两个设备不在统一个网段里面，我一样可以通过mac地址的方式帮你把数据转出去，但是中间要经过一个vxlan的隧道，而且你的网络设备必须要买支持vxlan功能的网络设备(主流)


sdn
软件定义网络
主要实现的是网络设备的控制平面和数据平面的隔离，说白一点就是实现网络设备的自动化
在云上面我建了一些vpc，很多人都会建很多vpc，虽然对于我们终端用户来说我们不同的用户之间的资源是隔离的，但是对于整个华为云的后台而言，我们建的所有的东西都是表现在一个云平台里面的，他是一个整体，假设华为内部人员要对云上的vpc进行策略上的更新，但是一个个改效率太低了，这个时候就可以用到sdn，通过sdn就可以实现集中的向所有的网络设备下发统一的配置
sdn又分两类
硬sdn 专业的硬件，单独的设备(sdn控制器)
软sdn  软件/平台，来对网络做集中的控制

### 2.5 swift组件
提供对象存储服务object storage /对象存储
负责存储磁盘镜像文件，磁盘备份文件

配合glance用来存储镜像或cinder卷的备份
单说glance他是负责云平台后端的这个镜像的上传下载，比如说我们将来这个云平台构建好之后，我们要大量的往云平台上面传一些镜像，然后glance支持很多种方式来存储这个镜像。
比如你要是最小化部署的话，你可以在服务器下面建一个文件夹然后配置glance使用这个文件夹来存储镜像，按真正的云平台构建来说，云平台的后端肯定有专业的存储设备，然后glance也支持去关联后端的设备来存储这些对象
，或者就是在云平台里面装一个swift，这就相当于云平台里面有了对象存储服务，将来也可以配置我的glance去关联swift这个对象存储，在这个对象存储里面存储上传的镜像文件

还有一方面提供云硬盘备份服务，云硬盘备份服务按照单纯的虚拟化来说就是，对硬盘建快照

### 2.6 cellometer组件
提供计量服务
计量服务不单单指计费，比如说这个云服务器是什么时候买的，用了多长时间什么时候删的，然后从费用来说，应该扣多少钱。你买的公网IP什么时候买的，用了多少带宽多少流量怎么计费
### 2.7 keystone组件
提供认证identity服务，最最核心的组件
负责用户的认证；鉴权
这个认证包含两个方面
(1)用户的认证
(2)我们需要有个整体意识，虽然我们是openstack里面有这么多组件，各干各的事，但从整个云平台的实现角度来讲，这些组件和组件之间是有关联的，而且这些组件是多个团队开发的，这些组件在相互传递数据，相互沟通的时候，他们需要找keystone做认证
### 2.8 dashboard组件
提供web UI 界面，web UI 可有可无，因为openstack支持命令行方式

### 2.9 heat组件
提供编排服务
编排服务就是说，一创建云服务来说，常规的方式就是在web界面上面选择参数，所谓的编排呢，就是创建资源的另一种方式，后面在K8S里面创建资源都是以所谓的编排的方式

